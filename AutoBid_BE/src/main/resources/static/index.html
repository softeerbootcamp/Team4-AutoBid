<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{auction.name}}</title>
</head>
<body>

<form id="btn" name="btn">
    <div class="form-group">
        <button type="submit">방만들기</button>
    </div>
</form>
<script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.1.4/sockjs.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>

<script>
    var btn = document.querySelector('#btn');

    var stompClient = null;
    btn.addEventListener('submit', connect, true)

    function addRoom() {
        for (var i = 1; i < 5; i++) {
            var socket = new SockJS("/auction-room/"+i+"/");
            stompClient = Stomp.over(socket);
        }
    }

    function connect(event){
        addRoom();
        stompClient.connect({}, onConnected);
        event.preventDefault();
    }

    function onConnected() { // 방만들기

        var auctionDto = {
            auctionId: "1",
            username: "ttta"
        };

        var auctionDto2 = {
            auctionId: "2",
            username: "juy"
        };


        // stompClient.send("/publish/createRoom", {}, JSON.stringify(auctionDto));
        // // stompClient.subscribe('/subscribe/auction/room/' + auctionDto.auctionId);
        // stompClient.subscribe('/subscribe/auction/room/' + auctionDto.auctionId, function (auctionDto) {
        //     var content = JSON.parse(auctionDto.body);
        // });



        // console.log(auctionDto.username + "님이 방을 만드셨습니다.");
        //
        // stompClient.send("/publish/createRoom", {}, JSON.stringify(auctionDto2));
        // stompClient.subscribe('/subscribe/auction/room/' + auctionDto2.auctionId);

        // console.log(auctionDto2.username + "님이 방을 만드셨습니다.");

        var userDto = {
            roomNum: auctionDto.auctionId,
            userName: "park",
            mobileNum: "4537"
        };

        var userDto2 = {
            roomNum: "2",
            userName: "nob",
            mobileNum: "1234"
        };

        stompClient.send("/publish/enterRoom/"+userDto.roomNum, {}, JSON.stringify(userDto));
        stompClient.subscribe('/subscribe/auction/room/' + userDto.roomNum);

        console.log("logic1" + userDto.userName + "님이" + userDto.roomNum + "번 방에 입장하셨습니다.");

        var roomnum = userDto2.roomNum;

        stompClient.send("/publish/enterRoom/"+roomnum, {}, JSON.stringify(userDto2));
        stompClient.subscribe('/subscribe/auction/room/' + userDto2.roomNum);

        console.log("logic2: " + userDto2.userName + "님이" + userDto2.roomNum + "번 방에 입장하셨습니다.");

    }
</script>
</body>
</html>

